<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cookbook &raquo; Conditional Tasking | Taskflow QuickStart</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <span id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">
        <a href="https://taskflow.github.io"><img src="taskflow_logo.png" alt="" />Taskflow</a> <span class="m-breadcrumb">|</span> <a href="index.html" class="m-thin">QuickStart</a>
      </span>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Handbook</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="Cookbook.html">Cookbook</a> &raquo;</span>
          Conditional Tasking
        </h1>
        <nav class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#CreateAConditionTask">Create a Condition Task</a></li>
            <li>
              <a href="#TaskSchedulingPolicy">Understand our Task-level Scheduling</a>
              <ul>
                <li><a href="#TaskLevelSchedulingExample">Example</a></li>
              </ul>
            </li>
            <li><a href="#AvoidCommonPitfalls">Avoid Common Pitfalls</a></li>
            <li>
              <a href="#ImplementControlFlowGraphs">Implement Control-flow Graphs</a>
              <ul>
                <li><a href="#ImplementIfElseControlFlow">Implement If-Else Control Flow</a></li>
                <li><a href="#ImplementSwitchControlFlow">Implement Switch Control Flow</a></li>
                <li><a href="#ImplementDoWhileLoopControlFlow">Implement Do-While-Loop Control Flow</a></li>
                <li><a href="#ImplementWhileLoopControlFlow">Implement While-Loop Control Flow</a></li>
              </ul>
            </li>
            <li><a href="#CreateAMultiConditionTask">Create a Multi-condition Task</a></li>
          </ul>
        </nav>
<p>Parallel workloads often require making control-flow decisions across dependent tasks. Taskflow supports an very efficient interface of conditional tasking for users to implement general control flow such as dynamic flow, cycles, and conditionals that are otherwise difficult to do with existing frameworks.</p><section id="CreateAConditionTask"><h2><a href="#CreateAConditionTask">Create a Condition Task</a></h2><p>A condition task evalutes a set of instructions and returns an integer index of the next successor task to execute. The index is defined with respect to the order of its successor construction. The following example creates an if-else block using a single condition task.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">init</span><span class="p">,</span><span class="w"> </span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">yes</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w">  </span><span class="p">[]</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w">  </span><span class="p">[]</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w">  </span><span class="p">[]</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;yes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w">  </span><span class="p">[]</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;no</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span><span class="n">cond</span><span class="p">.</span><span class="n">succeed</span><span class="p">(</span><span class="n">init</span><span class="p">)</span><span class="w"></span>
<span class="mi">11</span><span class="o">:</span><span class="w">     </span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">yes</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="p">);</span><span class="w">  </span><span class="c1">// executes yes if cond returns 0</span>
<span class="mi">12</span><span class="o">:</span><span class="w">                         </span><span class="c1">// executes no  if cond returns 1</span></pre><div class="m-graph"><svg style="width: 20.062rem; height: 6.250rem;" viewBox="0.00 0.00 321.21 99.77">
<g transform="scale(1 1) rotate(0) translate(4 95.7696)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7f9e1e700030</title>
<ellipse cx="28.9914" cy="-45.3848" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-41.5848">init</text>
</g>
<g class="m-node">
<title>p0x7f9e1e700140</title>
<polygon points="149.9828,-71.3848 94.9828,-45.3848 149.9828,-19.3848 204.9828,-45.3848 149.9828,-71.3848"/>
<text text-anchor="middle" x="149.9828" y="-41.5848">cond</text>
</g>
<g class="m-edge">
<title>p0x7f9e1e700030&#45;&gt;p0x7f9e1e700140</title>
<path d="M58.28,-45.3848C66.3949,-45.3848 75.5414,-45.3848 84.8352,-45.3848"/>
<polygon points="84.936,-48.8849 94.936,-45.3848 84.9359,-41.8849 84.936,-48.8849"/>
</g>
<g class="m-node m-flat">
<title>p0x7f9e1e700250</title>
<ellipse cx="282.0955" cy="-73.3848" rx="31.2258" ry="18.2703"/>
<text text-anchor="middle" x="282.0955" y="-69.5848">yes</text>
</g>
<g class="m-edge">
<title>p0x7f9e1e700140&#45;&gt;p0x7f9e1e700250</title>
<path stroke-dasharray="5,2" d="M188.1952,-53.4835C205.3953,-57.1289 225.6784,-61.4277 242.9838,-65.0954"/>
<polygon points="242.2746,-68.5228 252.7831,-67.1723 243.726,-61.6749 242.2746,-68.5228"/>
<text text-anchor="middle" x="227.9828" y="-67.5848">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7f9e1e700360</title>
<ellipse cx="282.0955" cy="-18.3848" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="282.0955" y="-14.5848">no</text>
</g>
<g class="m-edge">
<title>p0x7f9e1e700140&#45;&gt;p0x7f9e1e700360</title>
<path stroke-dasharray="5,2" d="M188.5504,-37.5027C206.6317,-33.8074 228.0574,-29.4286 245.8385,-25.7946"/>
<polygon points="246.7372,-29.1834 255.8338,-23.7519 245.3355,-22.3252 246.7372,-29.1834"/>
<text text-anchor="middle" x="227.9828" y="-35.5848">1</text>
</g>
</g>
</svg>
</div><p>Line 5 creates a condition task <code>cond</code> and line 11 creates two dependencies from <code>cond</code> to two other tasks, <code>yes</code> and <code>no</code>. With this order, when <code>cond</code> returns 0, the execution moves on to task <code>yes</code>. When <code>cond</code> returns 1, the execution moves on to task <code>no</code>.</p><aside class="m-note m-warning"><h4>Attention</h4><p>It is your responsibility to ensure the return of a condition task goes to a correct successor task. If the return falls beyond the range of the successors, the executor will not schedule any tasks.</p></aside><p>Condition task can go cyclic to describe <em>iterative</em> control flow. The example below implements a simple yet commonly used feedback loop through a condition task (line 7-10) that returns a random binary value. If the return value from <code>cond</code> is <code>0</code>, it loops back to itself, or otherwise to <code>stop</code>.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"> </span><span class="c1">// creates a condition task that returns 0 or 1</span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"></span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;flipping a coin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">11</span><span class="o">:</span><span class="w"></span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="c1">// creates a feedback loop {0: cond, 1: stop}</span>
<span class="mi">13</span><span class="o">:</span><span class="w"> </span><span class="n">init</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w"> </span><span class="n">cond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="p">);</span><span class="w">  </span><span class="c1">// returns 0 to &#39;cond&#39; or 1 to &#39;stop&#39;</span>
<span class="mi">15</span><span class="o">:</span><span class="w"></span>
<span class="mi">16</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><div class="m-graph"><svg style="width: 20.625rem; height: 6.000rem;" viewBox="0.00 0.00 329.69 96.00">
<g transform="scale(1 1) rotate(0) translate(4 92)">
<title>Taskflow</title>
<g class="m-node">
<title>cond</title>
<polygon points="149.9828,-52 94.9828,-26 149.9828,0 204.9828,-26 149.9828,-52"/>
<text text-anchor="middle" x="149.9828" y="-22.2">cond</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;cond</title>
<path stroke-dasharray="5,2" d="M137.3265,-46.3672C134.514,-58.5417 138.7328,-70 149.9828,-70 157.9808,-70 162.425,-64.2086 163.3154,-56.4858"/>
<polygon points="166.7983,-56.1114 162.639,-46.3672 159.8139,-56.5784 166.7983,-56.1114"/>
<text text-anchor="middle" x="149.9828" y="-75.2">0</text>
</g>
<g class="m-node m-flat">
<title>stop</title>
<ellipse cx="286.3381" cy="-26" rx="35.2113" ry="18.2703"/>
<text text-anchor="middle" x="286.3381" y="-22.2">stop</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;stop</title>
<path stroke-dasharray="5,2" d="M205.0507,-26C216.8214,-26 229.1338,-26 240.5123,-26"/>
<polygon points="240.6571,-29.5001 250.6571,-26 240.657,-22.5001 240.6571,-29.5001"/>
<text text-anchor="middle" x="227.9828" y="-31.2">1</text>
</g>
<g class="m-node m-flat">
<title>init</title>
<ellipse cx="28.9914" cy="-26" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-22.2">init</text>
</g>
<g class="m-edge">
<title>init&#45;&gt;cond</title>
<path d="M58.28,-26C66.3949,-26 75.5414,-26 84.8352,-26"/>
<polygon points="84.936,-29.5001 94.936,-26 84.9359,-22.5001 84.936,-29.5001"/>
</g>
</g>
</svg>
</div><p>A taskflow of complex control flow often just takes a few lines of code to implement, and different control flow blocks may run in parallel. The code below creates another taskflow with three condition tasks.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;F&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;G&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;H&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;K&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">cond_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">cond_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">cond_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_3&quot;</span><span class="p">);</span><span class="w"></span>

<span class="n">A</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">B</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">C</span><span class="p">);</span><span class="w"></span>
<span class="n">C</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">D</span><span class="p">);</span><span class="w"></span>
<span class="n">D</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_1</span><span class="p">);</span><span class="w"></span>
<span class="n">E</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">K</span><span class="p">);</span><span class="w"></span>
<span class="n">F</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_2</span><span class="p">);</span><span class="w"></span>
<span class="n">H</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">I</span><span class="p">);</span><span class="w"></span>
<span class="n">I</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_3</span><span class="p">);</span><span class="w"></span>
<span class="n">L</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">M</span><span class="p">);</span><span class="w"></span>

<span class="n">cond_1</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">);</span><span class="w">       </span><span class="c1">// return 0 to &#39;B&#39; or 1 to &#39;E&#39;</span>
<span class="n">cond_2</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">);</span><span class="w">       </span><span class="c1">// return 0 to &#39;G&#39; or 1 to &#39;H&#39;</span>
<span class="n">cond_3</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_3</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">);</span><span class="w">  </span><span class="c1">// return 0 to &#39;cond_3&#39; or 1 to &#39;L&#39;</span>

<span class="n">taskflow</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">);</span><span class="w"></span></pre><p>The above code creates three condition tasks: (1) a condition task <code>cond_1</code> that loops back to <code>B</code> on returning <code>0</code>, or proceeds to <code>E</code> on returning <code>1</code>, (2) a condition task <code>cond_2</code> that goes to <code>G</code> on returning <code>0</code>, or <code>H</code> on returning <code>1</code>, (3) a condition task <code>cond_3</code> that loops back to itself on returning <code>0</code>, or proceeds to <code>L</code> on returning <code>1</code></p><div class="m-graph"><svg style="width: 62.625rem; height: 12.688rem;" viewBox="0.00 0.00 1002.00 203.38">
<g transform="scale(1 1) rotate(0) translate(4 199.3848)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fecbdc02830</title>
<ellipse cx="27" cy="-104" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="27" y="-100.2">A</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02940</title>
<ellipse cx="118" cy="-132" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="118" y="-128.2">B</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02830&#45;&gt;p0x7fecbdc02940</title>
<path d="M51.8661,-111.6511C61.5966,-114.6451 72.9244,-118.1306 83.4267,-121.3621"/>
<polygon points="82.5768,-124.7624 93.1639,-124.3581 84.6354,-118.072 82.5768,-124.7624"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02d80</title>
<ellipse cx="118" cy="-77" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="118" y="-73.2">F</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02830&#45;&gt;p0x7fecbdc02d80</title>
<path d="M51.8661,-96.6221C61.5966,-93.7351 72.9244,-90.3741 83.4267,-87.258"/>
<polygon points="84.5726,-90.5689 93.1639,-84.3689 82.5814,-83.8581 84.5726,-90.5689"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02a50</title>
<ellipse cx="255" cy="-177" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="255" y="-173.2">C</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02940&#45;&gt;p0x7fecbdc02a50</title>
<path d="M142.4929,-140.0451C164.2745,-147.1997 196.3511,-157.7358 220.6866,-165.7292"/>
<polygon points="219.6644,-169.0773 230.2573,-168.8728 221.8489,-162.4269 219.6644,-169.0773"/>
</g>
<g class="m-node">
<title>p0x7fecbdc03600</title>
<polygon points="255,-103 182,-77 255,-51 328,-77 255,-103"/>
<text text-anchor="middle" x="255" y="-73.2">cond_2</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02d80&#45;&gt;p0x7fecbdc03600</title>
<path d="M145.0668,-77C153.0537,-77 162.2444,-77 171.8376,-77"/>
<polygon points="171.9469,-80.5001 181.9468,-77 171.9468,-73.5001 171.9469,-80.5001"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02b60</title>
<ellipse cx="401" cy="-177" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="401" y="-173.2">D</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02a50&#45;&gt;p0x7fecbdc02b60</title>
<path d="M282.1193,-177C305.0227,-177 338.0591,-177 363.4958,-177"/>
<polygon points="363.5305,-180.5001 373.5305,-177 363.5304,-173.5001 363.5305,-180.5001"/>
</g>
<g class="m-node">
<title>p0x7fecbdc034f0</title>
<polygon points="538,-174 465,-148 538,-122 611,-148 538,-174"/>
<text text-anchor="middle" x="538" y="-144.2">cond_1</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02b60&#45;&gt;p0x7fecbdc034f0</title>
<path d="M427.0911,-171.4771C442.6934,-168.1744 463.1351,-163.8473 482.2132,-159.8089"/>
<polygon points="482.9743,-163.2254 492.0326,-157.7303 481.5246,-156.3772 482.9743,-163.2254"/>
</g>
<g class="m-edge">
<title>p0x7fecbdc034f0&#45;&gt;p0x7fecbdc02940</title>
<path stroke-dasharray="5,2" d="M472.0069,-145.486C382.8434,-142.0893 226.8639,-136.1472 155.5298,-133.4297"/>
<polygon points="155.3598,-129.9208 145.2338,-133.0375 155.0932,-136.9157 155.3598,-129.9208"/>
<text text-anchor="middle" x="351" y="-146.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02c70</title>
<ellipse cx="730" cy="-148" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="730" y="-144.2">E</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc034f0&#45;&gt;p0x7fecbdc02c70</title>
<path stroke-dasharray="5,2" d="M611.1347,-148C638.8885,-148 669.3495,-148 692.4868,-148"/>
<polygon points="692.5661,-151.5001 702.566,-148 692.566,-144.5001 692.5661,-151.5001"/>
<text text-anchor="middle" x="634" y="-153.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc031c0</title>
<ellipse cx="876" cy="-148" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="876" y="-144.2">K</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02c70&#45;&gt;p0x7fecbdc031c0</title>
<path d="M757.1193,-148C780.0227,-148 813.0591,-148 838.4958,-148"/>
<polygon points="838.5305,-151.5001 848.5305,-148 838.5304,-144.5001 838.5305,-151.5001"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02e90</title>
<ellipse cx="401" cy="-81" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="401" y="-77.2">G</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03600&#45;&gt;p0x7fecbdc02e90</title>
<path stroke-dasharray="5,2" d="M322.8709,-78.8595C336.9498,-79.2452 351.2844,-79.6379 363.766,-79.9799"/>
<polygon points="363.6764,-83.4787 373.7686,-80.2539 363.8682,-76.4813 363.6764,-83.4787"/>
<text text-anchor="middle" x="351" y="-84.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02fa0</title>
<ellipse cx="401" cy="-26" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="401" y="-22.2">H</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03600&#45;&gt;p0x7fecbdc02fa0</title>
<path stroke-dasharray="5,2" d="M292.2197,-63.9986C315.3283,-55.9264 344.792,-45.6343 367.2256,-37.7979"/>
<polygon points="368.3934,-41.0975 376.6797,-34.4954 366.0849,-34.489 368.3934,-41.0975"/>
<text text-anchor="middle" x="351" y="-49.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc030b0</title>
<ellipse cx="538" cy="-26" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="538" y="-22.2">I</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02fa0&#45;&gt;p0x7fecbdc030b0</title>
<path d="M428.0668,-26C448.8949,-26 477.9092,-26 500.9006,-26"/>
<polygon points="500.9895,-29.5001 510.9894,-26 500.9894,-22.5001 500.9895,-29.5001"/>
</g>
<g class="m-node">
<title>p0x7fecbdc03710</title>
<polygon points="730,-52 657,-26 730,0 803,-26 730,-52"/>
<text text-anchor="middle" x="730" y="-22.2">cond_3</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc030b0&#45;&gt;p0x7fecbdc03710</title>
<path d="M565.1017,-26C586.3691,-26 617.1713,-26 646.4113,-26"/>
<polygon points="646.6705,-29.5001 656.6704,-26 646.6704,-22.5001 646.6705,-29.5001"/>
</g>
<g class="m-edge">
<title>p0x7fecbdc03710&#45;&gt;p0x7fecbdc03710</title>
<path stroke-dasharray="5,2" d="M713.125,-46.3672C709.375,-58.5417 715,-70 730,-70 740.6641,-70 746.5897,-64.2086 747.7769,-56.4858"/>
<polygon points="751.2491,-56.0169 746.875,-46.3672 744.2767,-56.6385 751.2491,-56.0169"/>
<text text-anchor="middle" x="730" y="-75.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc032d0</title>
<ellipse cx="876" cy="-26" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="876" y="-22.2">L</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03710&#45;&gt;p0x7fecbdc032d0</title>
<path stroke-dasharray="5,2" d="M803,-26C815.4255,-26 827.8509,-26 838.8364,-26"/>
<polygon points="838.8807,-29.5001 848.8807,-26 838.8806,-22.5001 838.8807,-29.5001"/>
<text text-anchor="middle" x="826" y="-31.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc033e0</title>
<ellipse cx="967" cy="-26" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="967" y="-22.2">M</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc032d0&#45;&gt;p0x7fecbdc033e0</title>
<path d="M903.303,-26C911.5813,-26 920.8217,-26 929.6405,-26"/>
<polygon points="929.7163,-29.5001 939.7163,-26 929.7162,-22.5001 929.7163,-29.5001"/>
</g>
</g>
</svg>
</div><p>You can use condition tasks to create cycles as long as the graph does not introduce task race during execution. However, cycles are not allowed in non-condition tasks.</p><aside class="m-note m-info"><h4>Note</h4><p>Conditional tasking lets you make in-task control-flow decisions to enable <em>end-to-end</em> parallelism, instead of resorting to client-side partition or synchronizing your task graph at the decision points of control flow.</p></aside></section><section id="TaskSchedulingPolicy"><h2><a href="#TaskSchedulingPolicy">Understand our Task-level Scheduling</a></h2><p>In order to understand how an executor schedules condition tasks, we define two dependency types, <em>strong dependency</em> and <em>weak dependency</em>. A strong dependency is a preceding link from a non-condition task to another task. A weak dependency is a preceding link from a condition task to another task. The number of dependents of a task is the sum of strong dependency and weak dependency. The table below lists the strong dependency and weak dependency numbers of each task in the previous example.</p><table class="m-table"><thead><tr><th>task</th><th>strong dependency</th><th>weak dependency</th><th>dependents</th></tr></thead><tbody><tr><td>A</td><td>0</td><td>0</td><td>0</td></tr><tr><td>B</td><td>1</td><td>1</td><td>2</td></tr><tr><td>C</td><td>1</td><td>0</td><td>1</td></tr><tr><td>D</td><td>1</td><td>0</td><td>1</td></tr><tr><td>E</td><td>0</td><td>1</td><td>1</td></tr><tr><td>F</td><td>1</td><td>0</td><td>1</td></tr><tr><td>G</td><td>0</td><td>1</td><td>1</td></tr><tr><td>H</td><td>0</td><td>1</td><td>1</td></tr><tr><td>I</td><td>1</td><td>0</td><td>1</td></tr><tr><td>K</td><td>1</td><td>0</td><td>1</td></tr><tr><td>L</td><td>0</td><td>1</td><td>1</td></tr><tr><td>M</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_1</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_2</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_3</td><td>1</td><td>1</td><td>2</td></tr></tbody></table><p>You can query the number of strong dependents, the number of weak dependents, and the number of dependents of a task.</p><pre class="m-code"><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span>
<span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){});</span><span class="w"></span>
<span class="mi">4</span><span class="o">:</span><span class="w"> </span>
<span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="c1">// ... add more tasks and preceding links</span>
<span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="n">num_dependents</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"></span>
<span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="n">num_strong_dependents</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"> </span>
<span class="mi">9</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="n">num_weak_dependents</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"></span></pre><p>When you submit a task to an executor, the scheduler starts with tasks of <em>zero dependents</em> (both zero strong and weak dependencies) and continues to execute successive tasks whenever their <em>strong dependencies</em> are met. However, the scheduler skips this rule when executing a condition task and jumps directly to its successors indexed by the return value.</p><div class="m-graph"><svg style="width: 71.125rem; height: 23.250rem;" viewBox="0.00 0.00 1137.79 372.08">
<g transform="scale(1 1) rotate(0) translate(4 368.0782)">
<title>G</title>
<g class="m-node m-flat">
<title>atask</title>
<ellipse cx="700.4529" cy="-345.6934" rx="56.6372" ry="18.2703"/>
<text text-anchor="middle" x="700.4529" y="-341.8934">a task T</text>
</g>
<g class="m-node">
<title>cond</title>
<polygon points="700.4529,-290.3087 516.4529,-264.3087 700.4529,-238.3087 884.4529,-264.3087 700.4529,-290.3087"/>
<text text-anchor="middle" x="700.4529" y="-260.5087">is T a condition task?</text>
</g>
<g class="m-edge">
<title>atask&#45;&gt;cond</title>
<path d="M700.4529,-327.226C700.4529,-319.3207 700.4529,-309.8011 700.4529,-300.587"/>
<polygon points="703.953,-300.4161 700.4529,-290.4161 696.953,-300.4162 703.953,-300.4161"/>
</g>
<g class="m-node m-flat">
<title>invokeN</title>
<ellipse cx="616.4529" cy="-165.9239" rx="62.8651" ry="18.2703"/>
<text text-anchor="middle" x="616.4529" y="-162.1239">invoke(T)</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;invokeN</title>
<path stroke-dasharray="5,2" d="M680.5461,-240.9928C667.9381,-226.2258 651.6169,-207.1096 638.6,-191.8637"/>
<polygon points="640.908,-189.1766 631.753,-183.8441 635.5844,-193.7219 640.908,-189.1766"/>
<text text-anchor="middle" x="671.4529" y="-207.5087">no</text>
</g>
<g class="m-node m-flat">
<title>invokeY</title>
<ellipse cx="886.4529" cy="-165.9239" rx="88.2768" ry="18.2703"/>
<text text-anchor="middle" x="886.4529" y="-162.1239">R = invoke(T)</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;invokeY</title>
<path stroke-dasharray="5,2" d="M739.4446,-243.684C770.3732,-227.3243 813.4977,-204.5136 845.0405,-187.829"/>
<polygon points="846.817,-190.8488 854.0201,-183.0792 843.544,-184.6611 846.817,-190.8488"/>
<text text-anchor="middle" x="830.4529" y="-207.5087">yes</text>
</g>
<g class="m-node m-flat">
<title>decrement</title>
<ellipse cx="363.4529" cy="-92.1543" rx="363.4058" ry="18.2703"/>
<text text-anchor="middle" x="363.4529" y="-88.3543">decrement strong dependencies of each successor of T by one</text>
</g>
<g class="m-edge">
<title>invokeN&#45;&gt;decrement</title>
<path d="M571.8039,-152.9052C534.0852,-141.9072 479.3521,-125.9482 435.4488,-113.1468"/>
<polygon points="436.2654,-109.7393 425.6854,-110.3 434.3059,-116.4594 436.2654,-109.7393"/>
</g>
<g class="m-node m-flat">
<title>enqueueR</title>
<ellipse cx="937.4529" cy="-92.1543" rx="192.1662" ry="18.2703"/>
<text text-anchor="middle" x="937.4529" y="-88.3543">enqueue the R&#45;th successor of T</text>
</g>
<g class="m-edge">
<title>invokeY&#45;&gt;enqueueR</title>
<path d="M899.0596,-147.6887C905.0217,-139.0647 912.26,-128.5949 918.8376,-119.0807"/>
<polygon points="921.8291,-120.9081 924.6369,-110.6921 916.0712,-116.9274 921.8291,-120.9081"/>
</g>
<g class="m-node m-flat">
<title>enqueueS</title>
<ellipse cx="363.4529" cy="-18.3848" rx="281.357" ry="18.2703"/>
<text text-anchor="middle" x="363.4529" y="-14.5848">enqueue successors of zero strong dpendencies</text>
</g>
<g class="m-edge">
<title>decrement&#45;&gt;enqueueS</title>
<path d="M363.4529,-73.5392C363.4529,-65.5014 363.4529,-55.9152 363.4529,-47.0069"/>
<polygon points="366.953,-46.994 363.4529,-36.994 359.953,-46.994 366.953,-46.994"/>
</g>
</g>
</svg>
</div><p>Each task has an <em>atomic</em> join counter to keep track of strong dependents that are met at runtime. When a task completes, the join counter is restored to the task&#x27;s strong dependency number in the graph, such that the subsequent execution can reuse the counter again.</p><section id="TaskLevelSchedulingExample"><h3><a href="#TaskLevelSchedulingExample">Example</a></h3><p>Let&#x27;s take a look at an example to understand how task-level scheduling works. Suppose we have the following taskflow of one condition task <code>cond</code> that forms a loop to itself on returning <code>0</code> and moves on to <code>stop</code> on returning <code>1</code>:</p><div class="m-graph"><svg style="width: 20.625rem; height: 6.000rem;" viewBox="0.00 0.00 329.69 96.00">
<g transform="scale(1 1) rotate(0) translate(4 92)">
<title>Taskflow</title>
<g class="m-node">
<title>cond</title>
<polygon points="149.9828,-52 94.9828,-26 149.9828,0 204.9828,-26 149.9828,-52"/>
<text text-anchor="middle" x="149.9828" y="-22.2">cond</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;cond</title>
<path stroke-dasharray="5,2" d="M137.3265,-46.3672C134.514,-58.5417 138.7328,-70 149.9828,-70 157.9808,-70 162.425,-64.2086 163.3154,-56.4858"/>
<polygon points="166.7983,-56.1114 162.639,-46.3672 159.8139,-56.5784 166.7983,-56.1114"/>
<text text-anchor="middle" x="149.9828" y="-75.2">0</text>
</g>
<g class="m-node m-flat">
<title>stop</title>
<ellipse cx="286.3381" cy="-26" rx="35.2113" ry="18.2703"/>
<text text-anchor="middle" x="286.3381" y="-22.2">stop</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;stop</title>
<path stroke-dasharray="5,2" d="M205.0507,-26C216.8214,-26 229.1338,-26 240.5123,-26"/>
<polygon points="240.6571,-29.5001 250.6571,-26 240.657,-22.5001 240.6571,-29.5001"/>
<text text-anchor="middle" x="227.9828" y="-31.2">1</text>
</g>
<g class="m-node m-flat">
<title>init</title>
<ellipse cx="28.9914" cy="-26" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-22.2">init</text>
</g>
<g class="m-edge">
<title>init&#45;&gt;cond</title>
<path d="M58.28,-26C66.3949,-26 75.5414,-26 84.8352,-26"/>
<polygon points="84.936,-29.5001 94.936,-26 84.9359,-22.5001 84.936,-29.5001"/>
</g>
</g>
</svg>
</div><p>The scheduler starts with <code>init</code> task because it has no dependencies (both strong and weak dependencies). Then, the scheduler moves on to the condition task <code>cond</code>. If <code>cond</code> returns <code>0</code>, the scheduler enqueues <code>cond</code> and runs it again. If <code>cond</code> returns <code>1</code>, the scheduler enqueues <code>stop</code> and then moves on.</p></section></section><section id="AvoidCommonPitfalls"><h2><a href="#AvoidCommonPitfalls">Avoid Common Pitfalls</a></h2><p>Condition tasks are handy in creasing dynamic and cyclic control flows, but they are also easy to make mistakes. It is your responsibility to ensure a taskflow is properly conditioned. Top things to avoid include <em>no source tasks</em> to start with and <em>task race</em>. The figure below shows common pitfalls and their remedies.</p><div class="m-graph"><svg style="width: 65.125rem; height: 24.438rem;" viewBox="0.00 0.00 1042.00 390.77">
<g transform="scale(1 1) rotate(0) translate(4 386.7696)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster_error1</title>
<polygon points="8,-144.3848 8,-374.7696 209,-374.7696 209,-144.3848 8,-144.3848"/>
<text text-anchor="middle" x="108.5" y="-357.9696">error1: no source tasks</text>
</g>
<g class="m-cluster">
<title>cluster_fix1</title>
<polygon points="217,-8 217,-367.1543 384,-367.1543 384,-8 217,-8"/>
<text text-anchor="middle" x="300.5" y="-350.3543">fix1: adds a source</text>
</g>
<g class="m-cluster">
<title>cluster_error2</title>
<polygon points="392,-144.3848 392,-374.7696 546,-374.7696 546,-144.3848 392,-144.3848"/>
<text text-anchor="middle" x="469" y="-357.9696">error2: race on D</text>
</g>
<g class="m-cluster">
<title>cluster_fix2</title>
<polygon points="554,-8 554,-374.7696 804,-374.7696 804,-8 554,-8"/>
<text text-anchor="middle" x="679" y="-357.9696">fix2: adds an auxiliary task</text>
</g>
<g class="m-cluster">
<title>cluster_risky</title>
<polygon points="812,-144.3848 812,-374.7696 1026,-374.7696 1026,-144.3848 812,-144.3848"/>
<text text-anchor="middle" x="919" y="-357.9696">risky: X might be raced</text>
</g>
<g class="m-node">
<title>e1A</title>
<polygon points="66,-340.7696 39,-314.7696 66,-288.7696 93,-314.7696 66,-340.7696"/>
<text text-anchor="middle" x="66" y="-310.9696">A</text>
</g>
<g class="m-edge">
<title>e1A&#45;&gt;e1A</title>
<path stroke-dasharray="5,2" d="M85.4268,-322.2924C98.3859,-324.41 111,-321.9024 111,-314.7696 111,-309.5314 104.1971,-306.7876 95.4506,-306.5383"/>
<polygon points="95.1552,-303.0503 85.4268,-307.2467 95.6487,-310.0329 95.1552,-303.0503"/>
<text text-anchor="middle" x="116" y="-310.9696">0</text>
</g>
<g class="m-node m-flat">
<title>e1B</title>
<ellipse cx="54" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="54" y="-166.9696">B</text>
</g>
<g class="m-edge">
<title>e1A&#45;&gt;e1B</title>
<path stroke-dasharray="5,2" d="M63.9915,-290.6672C61.9038,-265.6156 58.6363,-226.4057 56.4107,-199.698"/>
<polygon points="59.8744,-199.1153 55.5559,-189.4405 52.8985,-199.6967 59.8744,-199.1153"/>
<text text-anchor="middle" x="65" y="-238.9696">1</text>
</g>
<g class="m-node m-flat">
<title>e1C</title>
<ellipse cx="126" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="126" y="-166.9696">C</text>
</g>
<g class="m-edge">
<title>e1A&#45;&gt;e1C</title>
<path stroke-dasharray="5,2" d="M73.844,-295.9441C84.2438,-270.9845 102.6697,-226.7623 114.6047,-198.1183"/>
<polygon points="117.9163,-199.2704 118.5317,-188.6934 111.4547,-196.578 117.9163,-199.2704"/>
<text text-anchor="middle" x="104" y="-238.9696">2</text>
</g>
<g class="m-node m-flat">
<title>f1S</title>
<ellipse cx="275" cy="-314.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="275" y="-310.9696">S</text>
</g>
<g class="m-node">
<title>f1A</title>
<polygon points="275,-196.7696 248,-170.7696 275,-144.7696 302,-170.7696 275,-196.7696"/>
<text text-anchor="middle" x="275" y="-166.9696">A</text>
</g>
<g class="m-edge">
<title>f1S&#45;&gt;f1A</title>
<path d="M275,-296.2389C275,-273.8093 275,-235.5197 275,-207.1235"/>
<polygon points="278.5001,-206.7784 275,-196.7785 271.5001,-206.7785 278.5001,-206.7784"/>
</g>
<g class="m-edge">
<title>f1A&#45;&gt;f1A</title>
<path stroke-dasharray="5,2" d="M294.4268,-178.2924C307.3859,-180.41 320,-177.9024 320,-170.7696 320,-165.5314 313.1971,-162.7876 304.4506,-162.5383"/>
<polygon points="304.1552,-159.0503 294.4268,-163.2467 304.6487,-166.0329 304.1552,-159.0503"/>
<text text-anchor="middle" x="325" y="-166.9696">0</text>
</g>
<g class="m-node m-flat">
<title>f1B</title>
<ellipse cx="263" cy="-34.3848" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="263" y="-30.5848">B</text>
</g>
<g class="m-edge">
<title>f1A&#45;&gt;f1B</title>
<path stroke-dasharray="5,2" d="M272.8823,-146.7006C270.8309,-123.3858 267.7184,-88.0117 265.536,-63.2075"/>
<polygon points="268.9978,-62.6182 264.6347,-52.9635 262.0247,-63.2318 268.9978,-62.6182"/>
<text text-anchor="middle" x="274" y="-94.9696">1</text>
</g>
<g class="m-node m-flat">
<title>f1C</title>
<ellipse cx="335" cy="-34.3848" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="335" y="-30.5848">C</text>
</g>
<g class="m-edge">
<title>f1A&#45;&gt;f1C</title>
<path stroke-dasharray="5,2" d="M283.0919,-152.3761C293.4047,-128.9341 311.3123,-88.2288 323.1605,-61.2969"/>
<polygon points="326.403,-62.6181 327.2262,-52.0553 319.9956,-59.7992 326.403,-62.6181"/>
<text text-anchor="middle" x="315" y="-94.9696">2</text>
</g>
<g class="m-node">
<title>e2C</title>
<polygon points="505,-340.7696 477,-314.7696 505,-288.7696 533,-314.7696 505,-340.7696"/>
<text text-anchor="middle" x="505" y="-310.9696">C</text>
</g>
<g class="m-node m-flat">
<title>e2D</title>
<ellipse cx="433" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="433" y="-166.9696">D</text>
</g>
<g class="m-edge">
<title>e2C&#45;&gt;e2D</title>
<path stroke-dasharray="5,2" d="M496.0267,-296.823C483.5632,-271.8959 460.9145,-226.5985 446.432,-197.6336"/>
<polygon points="449.4629,-195.8689 441.8602,-188.4899 443.2019,-198.9995 449.4629,-195.8689"/>
<text text-anchor="middle" x="478" y="-238.9696">0</text>
</g>
<g class="m-node m-flat">
<title>e2F</title>
<ellipse cx="510" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="510" y="-166.9696">F</text>
</g>
<g class="m-edge">
<title>e2C&#45;&gt;e2F</title>
<path stroke-dasharray="5,2" d="M505.8824,-289.3567C506.7547,-264.2355 508.0873,-225.8542 508.9988,-199.6053"/>
<polygon points="512.5,-199.6286 509.3492,-189.5131 505.5042,-199.3856 512.5,-199.6286"/>
<text text-anchor="middle" x="512" y="-238.9696">1</text>
</g>
<g class="m-node m-flat">
<title>e2E</title>
<ellipse cx="427" cy="-314.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="427" y="-310.9696">E</text>
</g>
<g class="m-edge">
<title>e2E&#45;&gt;e2D</title>
<path d="M427.7721,-296.2389C428.7937,-271.7212 430.6048,-228.2532 431.8041,-199.471"/>
<polygon points="435.3114,-199.3662 432.2309,-189.2291 428.3175,-199.0747 435.3114,-199.3662"/>
</g>
<g class="m-node">
<title>f2C</title>
<polygon points="724,-340.7696 696,-314.7696 724,-288.7696 752,-314.7696 724,-340.7696"/>
<text text-anchor="middle" x="724" y="-310.9696">C</text>
</g>
<g class="m-node m-flat">
<title>f2Daux</title>
<ellipse cx="679" cy="-170.7696" rx="44.5955" ry="18.2703"/>
<text text-anchor="middle" x="679" y="-166.9696">D&#45;aux</text>
</g>
<g class="m-edge">
<title>f2C&#45;&gt;f2Daux</title>
<path stroke-dasharray="5,2" d="M717.648,-294.4433C709.8371,-269.4482 696.5384,-226.8926 687.7605,-198.8033"/>
<polygon points="691.0731,-197.6692 684.7496,-189.1684 684.3918,-199.7572 691.0731,-197.6692"/>
<text text-anchor="middle" x="709" y="-238.9696">0</text>
</g>
<g class="m-node m-flat">
<title>f2F</title>
<ellipse cx="769" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="769" y="-166.9696">F</text>
</g>
<g class="m-edge">
<title>f2C&#45;&gt;f2F</title>
<path stroke-dasharray="5,2" d="M730.352,-294.4433C738.1629,-269.4482 751.4616,-226.8926 760.2395,-198.8033"/>
<polygon points="763.6082,-199.7572 763.2504,-189.1684 756.9269,-197.6692 763.6082,-199.7572"/>
<text text-anchor="middle" x="754" y="-238.9696">1</text>
</g>
<g class="m-node m-flat">
<title>f2D</title>
<ellipse cx="634" cy="-34.3848" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="634" y="-30.5848">D</text>
</g>
<g class="m-edge">
<title>f2Daux&#45;&gt;f2D</title>
<path d="M672.9311,-152.3761C665.2729,-129.1659 652.0308,-89.032 643.1445,-62.0997"/>
<polygon points="646.4299,-60.8866 639.9727,-52.4868 639.7824,-63.0799 646.4299,-60.8866"/>
</g>
<g class="m-node m-flat">
<title>f2E</title>
<ellipse cx="589" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="589" y="-166.9696">E</text>
</g>
<g class="m-edge">
<title>f2E&#45;&gt;f2D</title>
<path d="M594.9757,-152.6587C602.6075,-129.5282 615.8924,-89.2648 624.8146,-62.2236"/>
<polygon points="628.19,-63.1637 627.9996,-52.5705 621.5425,-60.9703 628.19,-63.1637"/>
</g>
<g class="m-node">
<title>rP</title>
<polygon points="970,-340.7696 943,-314.7696 970,-288.7696 997,-314.7696 970,-340.7696"/>
<text text-anchor="middle" x="970" y="-310.9696">P</text>
</g>
<g class="m-node m-flat">
<title>rQ</title>
<ellipse cx="991" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="991" y="-166.9696">Q</text>
</g>
<g class="m-edge">
<title>rP&#45;&gt;rQ</title>
<path stroke-dasharray="5,2" d="M973.3275,-291.9523C976.9827,-266.8883 982.8591,-226.5926 986.8218,-199.4198"/>
<polygon points="990.3093,-199.7593 988.2891,-189.3588 983.3825,-198.749 990.3093,-199.7593"/>
<text text-anchor="middle" x="986" y="-238.9696">0</text>
</g>
<g class="m-node m-flat">
<title>rX</title>
<ellipse cx="919" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="919" y="-166.9696">X</text>
</g>
<g class="m-edge">
<title>rP&#45;&gt;rX</title>
<path stroke-dasharray="5,2" d="M963.1219,-295.3491C954.3075,-270.4615 938.9662,-227.1446 928.8971,-198.7144"/>
<polygon points="932.0856,-197.2331 925.4479,-188.9753 925.4872,-199.5701 932.0856,-197.2331"/>
<text text-anchor="middle" x="952" y="-238.9696">1</text>
</g>
<g class="m-node">
<title>rM</title>
<polygon points="875,-340.7696 845,-314.7696 875,-288.7696 905,-314.7696 875,-340.7696"/>
<text text-anchor="middle" x="875" y="-310.9696">M</text>
</g>
<g class="m-edge">
<title>rM&#45;&gt;rX</title>
<path stroke-dasharray="5,2" d="M881.3041,-294.1379C888.9653,-269.0649 901.9252,-226.6506 910.4728,-198.6766"/>
<polygon points="913.8293,-199.6689 913.4043,-189.0826 907.1349,-197.6233 913.8293,-199.6689"/>
<text text-anchor="middle" x="904" y="-238.9696">0</text>
</g>
<g class="m-node m-flat">
<title>rN</title>
<ellipse cx="847" cy="-170.7696" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="847" y="-166.9696">N</text>
</g>
<g class="m-edge">
<title>rM&#45;&gt;rN</title>
<path stroke-dasharray="5,2" d="M870.625,-292.2696C865.7368,-267.1301 857.8143,-226.3859 852.5079,-199.0958"/>
<polygon points="855.8906,-198.1553 850.5462,-189.0073 849.0193,-199.4915 855.8906,-198.1553"/>
<text text-anchor="middle" x="867" y="-238.9696">1</text>
</g>
</g>
</svg>
</div><p>In the <code>error1</code> scenario, there is no source task for the scheduler to start with, and the simplest fix is to add a task <code>S</code> that has no dependents. In the <code>error2</code> scenario, <code>D</code> might be scheduled twice by <code>E</code> through the strong dependency and <code>C</code> through the weak dependency (on returning <code>1</code>). To fix this problem, you can add an auxiliary task <code>D-aux</code> to break the mixed use of strong dependency and weak dependency. In the risky scenario, task <code>X</code> may be raced by <code>M</code> and <code>P</code> if <code>M</code> returns <code>0</code> and P returns <code>1</code>.</p><aside class="m-note m-warning"><h4>Attention</h4><p>It is your responsibility to ensure a written taskflow graph is properly conditioned. We suggest that you <a href="ConditionalTasking.html#TaskSchedulingPolicy" class="m-doc">Understand our Task-level Scheduling</a> and infer if task race exists in the execution of your graph.</p></aside></section><section id="ImplementControlFlowGraphs"><h2><a href="#ImplementControlFlowGraphs">Implement Control-flow Graphs</a></h2><section id="ImplementIfElseControlFlow"><h3><a href="#ImplementIfElseControlFlow">Implement If-Else Control Flow</a></h3><p>You can use conditional tasking to implement if-else control flow. The following example creates a nested if-else control flow diagram that executes three condition tasks to check the range of <code>i</code>.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="c1">// create three condition tasks for nested control flow</span>
<span class="k">auto</span><span class="w"> </span><span class="n">initi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>
<span class="k">auto</span><span class="w"> </span><span class="n">cond1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>
<span class="k">auto</span><span class="w"> </span><span class="n">cond2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>
<span class="k">auto</span><span class="w"> </span><span class="n">cond3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>
<span class="k">auto</span><span class="w"> </span><span class="n">equl1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i=1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>
<span class="k">auto</span><span class="w"> </span><span class="n">equl2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i=2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>
<span class="k">auto</span><span class="w"> </span><span class="n">equl3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i=3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>
<span class="k">auto</span><span class="w"> </span><span class="n">grtr3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i&gt;3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span>

<span class="n">initi</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond1</span><span class="p">);</span><span class="w"></span>
<span class="n">cond1</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">equl1</span><span class="p">,</span><span class="w"> </span><span class="n">cond2</span><span class="p">);</span><span class="w">  </span><span class="c1">// goes to cond2 if i&gt;1</span>
<span class="n">cond2</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">equl2</span><span class="p">,</span><span class="w"> </span><span class="n">cond3</span><span class="p">);</span><span class="w">  </span><span class="c1">// goes to cond3 if i&gt;2</span>
<span class="n">cond3</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">equl3</span><span class="p">,</span><span class="w"> </span><span class="n">grtr3</span><span class="p">);</span><span class="w">  </span><span class="c1">// goes to grtr3 if i&gt;3</span></pre><div class="m-graph"><svg style="width: 81.875rem; height: 10.312rem;" viewBox="0.00 0.00 1309.84 164.77">
<g transform="scale(1 1) rotate(0) translate(4 160.7696)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fc231700030</title>
<ellipse cx="28.9914" cy="-107.3848" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-103.5848">init</text>
</g>
<g class="m-node">
<title>p0x7fc231700140</title>
<polygon points="258.9828,-133.3848 94.9828,-107.3848 258.9828,-81.3848 422.9828,-107.3848 258.9828,-133.3848"/>
<text text-anchor="middle" x="258.9828" y="-103.5848">cond1 (i&gt;1 ? 1 : 0)</text>
</g>
<g class="m-edge">
<title>p0x7fc231700030&#45;&gt;p0x7fc231700140</title>
<path d="M58.1199,-107.3848C65.9163,-107.3848 74.9361,-107.3848 84.7473,-107.3848"/>
<polygon points="84.8063,-110.8849 94.8063,-107.3848 84.8062,-103.8849 84.8063,-110.8849"/>
</g>
<g class="m-node m-flat">
<title>p0x7fc231700470</title>
<ellipse cx="632.9828" cy="-138.3848" rx="42.3529" ry="18.2703"/>
<text text-anchor="middle" x="632.9828" y="-134.5848">equl1</text>
</g>
<g class="m-edge">
<title>p0x7fc231700140&#45;&gt;p0x7fc231700470</title>
<path stroke-dasharray="5,2" d="M366.9081,-116.3305C437.2455,-122.1606 525.8784,-129.5071 580.9954,-134.0757"/>
<polygon points="580.9657,-137.5851 591.2207,-134.9232 581.544,-130.609 580.9657,-137.5851"/>
<text text-anchor="middle" x="445.9828" y="-127.5848">0</text>
</g>
<g class="m-node">
<title>p0x7fc231700250</title>
<polygon points="632.9828,-102.3848 468.9828,-76.3848 632.9828,-50.3848 796.9828,-76.3848 632.9828,-102.3848"/>
<text text-anchor="middle" x="632.9828" y="-72.5848">cond2 (i&gt;2 ? 1 : 0)</text>
</g>
<g class="m-edge">
<title>p0x7fc231700140&#45;&gt;p0x7fc231700250</title>
<path stroke-dasharray="5,2" d="M366.9081,-98.4391C413.3394,-94.5905 467.7431,-90.0811 515.2155,-86.1462"/>
<polygon points="515.5583,-89.6299 525.235,-85.3157 514.98,-82.6538 515.5583,-89.6299"/>
<text text-anchor="middle" x="445.9828" y="-96.5848">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fc231700580</title>
<ellipse cx="1006.9828" cy="-107.3848" rx="42.3529" ry="18.2703"/>
<text text-anchor="middle" x="1006.9828" y="-103.5848">equl2</text>
</g>
<g class="m-edge">
<title>p0x7fc231700250&#45;&gt;p0x7fc231700580</title>
<path stroke-dasharray="5,2" d="M740.9081,-85.3305C811.2455,-91.1606 899.8784,-98.5071 954.9954,-103.0757"/>
<polygon points="954.9657,-106.5851 965.2207,-103.9232 955.544,-99.609 954.9657,-106.5851"/>
<text text-anchor="middle" x="819.9828" y="-96.5848">0</text>
</g>
<g class="m-node">
<title>p0x7fc231700360</title>
<polygon points="1006.9828,-71.3848 842.9828,-45.3848 1006.9828,-19.3848 1170.9828,-45.3848 1006.9828,-71.3848"/>
<text text-anchor="middle" x="1006.9828" y="-41.5848">cond3 (i&gt;3 ? 1 : 0)</text>
</g>
<g class="m-edge">
<title>p0x7fc231700250&#45;&gt;p0x7fc231700360</title>
<path stroke-dasharray="5,2" d="M740.9081,-67.4391C787.3394,-63.5905 841.7431,-59.0811 889.2155,-55.1462"/>
<polygon points="889.5583,-58.6299 899.235,-54.3157 888.98,-51.6538 889.5583,-58.6299"/>
<text text-anchor="middle" x="819.9828" y="-65.5848">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fc231700690</title>
<ellipse cx="1259.4092" cy="-73.3848" rx="42.3529" ry="18.2703"/>
<text text-anchor="middle" x="1259.4092" y="-69.5848">equl3</text>
</g>
<g class="m-edge">
<title>p0x7fc231700360&#45;&gt;p0x7fc231700690</title>
<path stroke-dasharray="5,2" d="M1103.4948,-56.0902C1138.978,-60.0261 1177.7816,-64.3304 1207.8014,-67.6603"/>
<polygon points="1207.7086,-71.1714 1218.0335,-68.7953 1208.4804,-64.214 1207.7086,-71.1714"/>
<text text-anchor="middle" x="1193.9828" y="-71.5848">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fc2317007a0</title>
<ellipse cx="1259.4092" cy="-18.3848" rx="39.6962" ry="18.2703"/>
<text text-anchor="middle" x="1259.4092" y="-14.5848">grtr3</text>
</g>
<g class="m-edge">
<title>p0x7fc231700360&#45;&gt;p0x7fc2317007a0</title>
<path stroke-dasharray="5,2" d="M1104.9387,-34.9072C1141.1374,-31.0353 1180.605,-26.8138 1210.5849,-23.6071"/>
<polygon points="1211.2016,-27.0612 1220.7726,-22.5174 1210.457,-20.1009 1211.2016,-27.0612"/>
<text text-anchor="middle" x="1193.9828" y="-31.5848">1</text>
</g>
</g>
</svg>
</div></section><section id="ImplementSwitchControlFlow"><h3><a href="#ImplementSwitchControlFlow">Implement Switch Control Flow</a></h3><p>You can use conditional tasking to implement <em>switch</em> control flow. The following example creates a switch control flow diagram that executes one of the three cases at random using four condition tasks.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">swcond</span><span class="p">,</span><span class="w"> </span><span class="n">case1</span><span class="p">,</span><span class="w"> </span><span class="n">case2</span><span class="p">,</span><span class="w"> </span><span class="n">case3</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;source</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;switch</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;case 1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;case 2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;case 3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;target</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">source</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">swcond</span><span class="p">);</span><span class="w"></span>
<span class="n">swcond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">case1</span><span class="p">,</span><span class="w"> </span><span class="n">case2</span><span class="p">,</span><span class="w"> </span><span class="n">case3</span><span class="p">);</span><span class="w"></span>
<span class="n">target</span><span class="p">.</span><span class="n">succeed</span><span class="p">(</span><span class="n">case1</span><span class="p">,</span><span class="w"> </span><span class="n">case2</span><span class="p">,</span><span class="w"> </span><span class="n">case3</span><span class="p">);</span><span class="w"></span></pre><div class="m-graph"><svg style="width: 37.375rem; height: 12.500rem;" viewBox="0.00 0.00 597.92 200.00">
<g transform="scale(1 1) rotate(0) translate(4 196)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fa25f000030</title>
<ellipse cx="49.4975" cy="-96" rx="49.4949" ry="18.2703"/>
<text text-anchor="middle" x="49.4975" y="-92.2">source</text>
</g>
<g class="m-node">
<title>p0x7fa25f000140</title>
<polygon points="202.9949,-122 135.9949,-96 202.9949,-70 269.9949,-96 202.9949,-122"/>
<text text-anchor="middle" x="202.9949" y="-92.2">switch</text>
</g>
<g class="m-edge">
<title>p0x7fa25f000030&#45;&gt;p0x7fa25f000140</title>
<path d="M99.3337,-96C107.7929,-96 116.7515,-96 125.7198,-96"/>
<polygon points="125.8232,-99.5001 135.8231,-96 125.8231,-92.5001 125.8232,-99.5001"/>
</g>
<g class="m-node">
<title>p0x7fa25f000250</title>
<polygon points="383.9949,-192 315.9949,-166 383.9949,-140 451.9949,-166 383.9949,-192"/>
<text text-anchor="middle" x="383.9949" y="-162.2">case 1</text>
</g>
<g class="m-edge">
<title>p0x7fa25f000140&#45;&gt;p0x7fa25f000250</title>
<path stroke-dasharray="5,2" d="M236.6155,-109.0024C265.8928,-120.3251 308.526,-136.8131 340.4152,-149.146"/>
<polygon points="339.351,-152.487 349.9403,-152.8297 341.876,-145.9582 339.351,-152.487"/>
<text text-anchor="middle" x="292.9949" y="-136.2">0</text>
</g>
<g class="m-node">
<title>p0x7fa25f000360</title>
<polygon points="383.9949,-122 315.9949,-96 383.9949,-70 451.9949,-96 383.9949,-122"/>
<text text-anchor="middle" x="383.9949" y="-92.2">case 2</text>
</g>
<g class="m-edge">
<title>p0x7fa25f000140&#45;&gt;p0x7fa25f000360</title>
<path stroke-dasharray="5,2" d="M270.1355,-96C281.6518,-96 293.7099,-96 305.4918,-96"/>
<polygon points="305.7541,-99.5001 315.754,-96 305.754,-92.5001 305.7541,-99.5001"/>
<text text-anchor="middle" x="292.9949" y="-101.2">1</text>
</g>
<g class="m-node">
<title>p0x7fa25f000470</title>
<polygon points="383.9949,-52 315.9949,-26 383.9949,0 451.9949,-26 383.9949,-52"/>
<text text-anchor="middle" x="383.9949" y="-22.2">case 3</text>
</g>
<g class="m-edge">
<title>p0x7fa25f000140&#45;&gt;p0x7fa25f000470</title>
<path stroke-dasharray="5,2" d="M236.6155,-82.9976C265.8928,-71.6749 308.526,-55.1869 340.4152,-42.854"/>
<polygon points="341.876,-46.0418 349.9403,-39.1703 339.351,-39.513 341.876,-46.0418"/>
<text text-anchor="middle" x="292.9949" y="-68.2">2</text>
</g>
<g class="m-node m-flat">
<title>p0x7fa25f000580</title>
<ellipse cx="543.9569" cy="-96" rx="45.9239" ry="18.2703"/>
<text text-anchor="middle" x="543.9569" y="-92.2">target</text>
</g>
<g class="m-edge">
<title>p0x7fa25f000250&#45;&gt;p0x7fa25f000580</title>
<path stroke-dasharray="5,2" d="M415.9812,-152.0027C441.1825,-140.9745 476.4722,-125.5316 503.6125,-113.6549"/>
<polygon points="505.0845,-116.8312 512.8426,-109.6157 502.2782,-110.4184 505.0845,-116.8312"/>
<text text-anchor="middle" x="474.9949" y="-131.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fa25f000360&#45;&gt;p0x7fa25f000580</title>
<path stroke-dasharray="5,2" d="M452.2972,-96C463.9997,-96 476.0432,-96 487.3962,-96"/>
<polygon points="487.5987,-99.5001 497.5987,-96 487.5986,-92.5001 487.5987,-99.5001"/>
<text text-anchor="middle" x="474.9949" y="-101.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fa25f000470&#45;&gt;p0x7fa25f000580</title>
<path stroke-dasharray="5,2" d="M415.9812,-39.9973C441.1825,-51.0255 476.4722,-66.4684 503.6125,-78.3451"/>
<polygon points="502.2782,-81.5816 512.8426,-82.3843 505.0845,-75.1688 502.2782,-81.5816"/>
<text text-anchor="middle" x="474.9949" y="-72.2">0</text>
</g>
</g>
</svg>
</div><p>Assuming <code>swcond</code> returns 1, the program outputs:</p><pre class="m-console"><span class="go">source</span>
<span class="go">switch</span>
<span class="go">case 2</span>
<span class="go">target</span></pre><p>Keep in mind, both switch and case tasks must be described as condition tasks. The following implementation is a common mistake in which case tasks are not described as condition tasks.</p><pre class="m-code"><span class="c1">// wrong implementation of switch control flow using only one condition task</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">swcond</span><span class="p">,</span><span class="w"> </span><span class="n">case1</span><span class="p">,</span><span class="w"> </span><span class="n">case2</span><span class="p">,</span><span class="w"> </span><span class="n">case3</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;source</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;switch</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;case 1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;case 2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;case 3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;target</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// target has three strong dependencies</span>
<span class="p">);</span><span class="w"></span>

<span class="n">source</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">swcond</span><span class="p">);</span><span class="w"></span>
<span class="n">swcond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">case1</span><span class="p">,</span><span class="w"> </span><span class="n">case2</span><span class="p">,</span><span class="w"> </span><span class="n">case3</span><span class="p">);</span><span class="w"></span>
<span class="n">target</span><span class="p">.</span><span class="n">succeed</span><span class="p">(</span><span class="n">case1</span><span class="p">,</span><span class="w"> </span><span class="n">case2</span><span class="p">,</span><span class="w"> </span><span class="n">case3</span><span class="p">);</span><span class="w"></span></pre><div class="m-graph"><svg style="width: 34.312rem; height: 9.688rem;" viewBox="0.00 0.00 549.09 154.77">
<g transform="scale(1 1) rotate(0) translate(4 150.7696)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7f96d3000030</title>
<ellipse cx="49.4975" cy="-73.3848" rx="49.4949" ry="18.2703"/>
<text text-anchor="middle" x="49.4975" y="-69.5848">source</text>
</g>
<g class="m-node">
<title>p0x7f96d3000140</title>
<polygon points="202.9949,-99.3848 135.9949,-73.3848 202.9949,-47.3848 269.9949,-73.3848 202.9949,-99.3848"/>
<text text-anchor="middle" x="202.9949" y="-69.5848">switch</text>
</g>
<g class="m-edge">
<title>p0x7f96d3000030&#45;&gt;p0x7f96d3000140</title>
<path d="M99.3337,-73.3848C107.7929,-73.3848 116.7515,-73.3848 125.7198,-73.3848"/>
<polygon points="125.8232,-76.8849 135.8231,-73.3848 125.8231,-69.8849 125.8232,-76.8849"/>
</g>
<g class="m-node m-flat">
<title>p0x7f96d3000250</title>
<ellipse cx="364.0782" cy="-128.3848" rx="48.1667" ry="18.2703"/>
<text text-anchor="middle" x="364.0782" y="-124.5848">case 1</text>
</g>
<g class="m-edge">
<title>p0x7f96d3000140&#45;&gt;p0x7f96d3000250</title>
<path stroke-dasharray="5,2" d="M238.7445,-85.5911C262.2287,-93.6095 293.1625,-104.1714 318.422,-112.796"/>
<polygon points="317.5559,-116.1986 328.1504,-116.1176 319.8178,-109.5741 317.5559,-116.1986"/>
<text text-anchor="middle" x="292.9949" y="-110.5848">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7f96d3000360</title>
<ellipse cx="364.0782" cy="-73.3848" rx="48.1667" ry="18.2703"/>
<text text-anchor="middle" x="364.0782" y="-69.5848">case 2</text>
</g>
<g class="m-edge">
<title>p0x7f96d3000140&#45;&gt;p0x7f96d3000360</title>
<path stroke-dasharray="5,2" d="M270.3754,-73.3848C281.9926,-73.3848 293.9853,-73.3848 305.3511,-73.3848"/>
<polygon points="305.5841,-76.8849 315.5841,-73.3848 305.5841,-69.8849 305.5841,-76.8849"/>
<text text-anchor="middle" x="292.9949" y="-78.5848">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7f96d3000470</title>
<ellipse cx="364.0782" cy="-18.3848" rx="48.1667" ry="18.2703"/>
<text text-anchor="middle" x="364.0782" y="-14.5848">case 3</text>
</g>
<g class="m-edge">
<title>p0x7f96d3000140&#45;&gt;p0x7f96d3000470</title>
<path stroke-dasharray="5,2" d="M238.7445,-61.1785C262.2287,-53.1601 293.1625,-42.5981 318.422,-33.9736"/>
<polygon points="319.8178,-37.1955 328.1504,-30.6519 317.5559,-30.571 319.8178,-37.1955"/>
<text text-anchor="middle" x="292.9949" y="-49.5848">2</text>
</g>
<g class="m-node m-flat">
<title>p0x7f96d3000580</title>
<ellipse cx="495.1234" cy="-73.3848" rx="45.9239" ry="18.2703"/>
<text text-anchor="middle" x="495.1234" y="-69.5848">target</text>
</g>
<g class="m-edge">
<title>p0x7f96d3000250&#45;&gt;p0x7f96d3000580</title>
<path d="M396.4714,-114.7893C413.7689,-107.5295 435.2466,-98.5152 453.7412,-90.753"/>
<polygon points="455.2365,-93.9212 463.1028,-86.8239 452.5275,-87.4667 455.2365,-93.9212"/>
</g>
<g class="m-edge">
<title>p0x7f96d3000360&#45;&gt;p0x7f96d3000580</title>
<path d="M412.5023,-73.3848C421.0965,-73.3848 430.1128,-73.3848 438.9012,-73.3848"/>
<polygon points="439.0744,-76.8849 449.0744,-73.3848 439.0743,-69.8849 439.0744,-76.8849"/>
</g>
<g class="m-edge">
<title>p0x7f96d3000470&#45;&gt;p0x7f96d3000580</title>
<path d="M396.4714,-31.9803C413.7689,-39.2401 435.2466,-48.2543 453.7412,-56.0166"/>
<polygon points="452.5275,-59.3029 463.1028,-59.9457 455.2365,-52.8483 452.5275,-59.3029"/>
</g>
</g>
</svg>
</div><p>In this faulty implementation, task <code>target</code> has three strong dependencies but only one of them will be met. This is because <code>swcond</code> is a condition task, and only one case task will be executed depending on the return of <code>swcond</code>.</p></section><section id="ImplementDoWhileLoopControlFlow"><h3><a href="#ImplementDoWhileLoopControlFlow">Implement Do-While-Loop Control Flow</a></h3><p>You can use conditional tasking to implement <em>do-while-loop</em> control flow. The following example creates a do-while-loop control flow diagram that repeatedly increments variable <code>i</code> five times using one condition task.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">init</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i=0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i++ =&gt; i=&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;done</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">);</span><span class="w">  </span>

<span class="n">init</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">body</span><span class="p">);</span><span class="w"></span>
<span class="n">body</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span><span class="w"></span>
<span class="n">cond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">);</span><span class="w"></span></pre><div class="m-graph"><svg style="width: 34.938rem; height: 3.750rem;" viewBox="0.00 0.00 559.42 60.00">
<g transform="scale(1 1) rotate(0) translate(4 56)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7f950d600030</title>
<ellipse cx="28.9914" cy="-26" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-22.2">init</text>
</g>
<g class="m-node m-flat">
<title>p0x7f950d600140</title>
<ellipse cx="146.6016" cy="-26" rx="51.7379" ry="18.2703"/>
<text text-anchor="middle" x="146.6016" y="-22.2">do i++</text>
</g>
<g class="m-edge">
<title>p0x7f950d600030&#45;&gt;p0x7f950d600140</title>
<path d="M58.0636,-26C66.2561,-26 75.4934,-26 84.8307,-26"/>
<polygon points="84.9572,-29.5001 94.9572,-26 84.9572,-22.5001 84.9572,-29.5001"/>
</g>
<g class="m-node">
<title>p0x7f950d600250</title>
<polygon points="335.2203,-52 244.2203,-26 335.2203,0 426.2203,-26 335.2203,-52"/>
<text text-anchor="middle" x="335.2203" y="-22.2">while i&lt;5</text>
</g>
<g class="m-edge">
<title>p0x7f950d600140&#45;&gt;p0x7f950d600250</title>
<path d="M197.9202,-28.462C204.0854,-28.6837 210.2938,-28.8724 216.2203,-29 225.3243,-29.1961 234.8197,-29.2358 244.3021,-29.1671"/>
<polygon points="244.6071,-32.664 254.5673,-29.0524 244.5288,-25.6644 244.6071,-32.664"/>
</g>
<g class="m-edge">
<title>p0x7f950d600250&#45;&gt;p0x7f950d600140</title>
<path stroke-dasharray="5,2" d="M290.6562,-12.6586C268.3447,-7.5663 240.8962,-3.6933 216.2203,-7 209.2956,-7.928 202.0842,-9.3532 195.0396,-11.0151"/>
<polygon points="193.7235,-7.738 184.8907,-13.5889 195.4442,-14.5232 193.7235,-7.738"/>
<text text-anchor="middle" x="221.2203" y="-12.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7f950d600360</title>
<ellipse cx="511.8183" cy="-26" rx="39.6962" ry="18.2703"/>
<text text-anchor="middle" x="511.8183" y="-22.2">done</text>
</g>
<g class="m-edge">
<title>p0x7f950d600250&#45;&gt;p0x7f950d600360</title>
<path stroke-dasharray="5,2" d="M426.3645,-26C438.5078,-26 450.5793,-26 461.6591,-26"/>
<polygon points="461.948,-29.5001 471.948,-26 461.948,-22.5001 461.948,-29.5001"/>
<text text-anchor="middle" x="449.2203" y="-31.2">1</text>
</g>
</g>
</svg>
</div><p>The program outputs:</p><pre class="m-console"><span class="go">i=0</span>
<span class="go">i++ =&gt; i=1</span>
<span class="go">i++ =&gt; i=2</span>
<span class="go">i++ =&gt; i=3</span>
<span class="go">i++ =&gt; i=4</span>
<span class="go">i++ =&gt; i=5</span>
<span class="go">done</span></pre></section><section id="ImplementWhileLoopControlFlow"><h3><a href="#ImplementWhileLoopControlFlow">Implement While-Loop Control Flow</a></h3><p>You can use conditional tasking to implement <em>while-loop</em> control flow. The following example creates a while-loop control flow diagram that repeatedly increments variable <code>i</code> five times using two condition task.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">init</span><span class="p">,</span><span class="w"> </span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">back</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i=0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;while i&lt;5</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i++=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;back</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;done</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">init</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span><span class="w"></span>
<span class="n">cond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">);</span><span class="w"></span>
<span class="n">body</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">back</span><span class="p">);</span><span class="w"></span>
<span class="n">back</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span><span class="w"></span></pre><div class="m-graph"><svg style="width: 34.688rem; height: 9.312rem;" viewBox="0.00 0.00 555.18 149.38">
<g transform="scale(1 1) rotate(0) translate(4 145.3848)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fdba4000030</title>
<ellipse cx="28.9914" cy="-68" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-64.2">init</text>
</g>
<g class="m-node">
<title>p0x7fdba4000140</title>
<polygon points="185.9828,-94 94.9828,-68 185.9828,-42 276.9828,-68 185.9828,-94"/>
<text text-anchor="middle" x="185.9828" y="-64.2">while i&lt;5</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000030&#45;&gt;p0x7fdba4000140</title>
<path d="M58.1523,-68C66.1156,-68 75.2181,-68 84.8151,-68"/>
<polygon points="84.9683,-71.5001 94.9683,-68 84.9683,-64.5001 84.9683,-71.5001"/>
</g>
<g class="m-node m-flat">
<title>p0x7fdba4000470</title>
<ellipse cx="362.5807" cy="-123" rx="39.6962" ry="18.2703"/>
<text text-anchor="middle" x="362.5807" y="-119.2">done</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000140&#45;&gt;p0x7fdba4000470</title>
<path stroke-dasharray="5,2" d="M229.6362,-81.5955C257.1997,-90.1799 292.6397,-101.2174 319.9961,-109.7373"/>
<polygon points="319.091,-113.1212 329.6794,-112.7532 321.1725,-106.4379 319.091,-113.1212"/>
<text text-anchor="middle" x="299.9828" y="-108.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fdba4000250</title>
<ellipse cx="362.5807" cy="-68" rx="33.8824" ry="18.2703"/>
<text text-anchor="middle" x="362.5807" y="-64.2">i++</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000140&#45;&gt;p0x7fdba4000250</title>
<path stroke-dasharray="5,2" d="M277.1269,-68C291.4907,-68 305.754,-68 318.3943,-68"/>
<polygon points="318.5971,-71.5001 328.597,-68 318.597,-64.5001 318.5971,-71.5001"/>
<text text-anchor="middle" x="299.9828" y="-73.2">0</text>
</g>
<g class="m-node">
<title>p0x7fdba4000360</title>
<polygon points="493.1787,-52 439.1787,-26 493.1787,0 547.1787,-26 493.1787,-52"/>
<text text-anchor="middle" x="493.1787" y="-22.2">back</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000250&#45;&gt;p0x7fdba4000360</title>
<path d="M391.8895,-58.5744C409.3087,-52.9724 431.697,-45.7724 450.9935,-39.5667"/>
<polygon points="452.3115,-42.8194 460.7597,-36.4259 450.1684,-36.1555 452.3115,-42.8194"/>
</g>
<g class="m-edge">
<title>p0x7fdba4000360&#45;&gt;p0x7fdba4000140</title>
<path stroke-dasharray="5,2" d="M443.1212,-24.0533C429.8163,-23.617 415.455,-23.2188 402.1787,-23 366.9853,-22.42 357.7387,-17.4381 322.9828,-23 291.9659,-27.9636 258.4432,-38.8714 232.3218,-48.7044"/>
<polygon points="230.7717,-45.5505 222.6935,-52.4058 233.2835,-52.0844 230.7717,-45.5505"/>
<text text-anchor="middle" x="362.5807" y="-28.2">0</text>
</g>
</g>
</svg>
</div><p>The program outputs:</p><pre class="m-console"><span class="go">i=0</span>
<span class="go">while i&lt;5</span>
<span class="go">i++=0</span>
<span class="go">back</span>
<span class="go">while i&lt;5</span>
<span class="go">i++=1</span>
<span class="go">back</span>
<span class="go">while i&lt;5</span>
<span class="go">i++=2</span>
<span class="go">back</span>
<span class="go">while i&lt;5</span>
<span class="go">i++=3</span>
<span class="go">back</span>
<span class="go">while i&lt;5</span>
<span class="go">i++=4</span>
<span class="go">back</span>
<span class="go">while i&lt;5</span>
<span class="go">done</span></pre><p>Notice that, when you implement a while-loop block, you cannot direct a dependency from the body task to the loop condition task. Doing so will introduce a strong dependency between the body task and the loop condition task, and the loop condition task will never be executed. The following code shows a common faulty implementation of while-loop control flow.</p><pre class="m-code"><span class="c1">// wrong implementation of while-loop using only one condition task</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">init</span><span class="p">,</span><span class="w"> </span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i=0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;while i&lt;5</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i++=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;done</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">init</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span><span class="w"></span>
<span class="n">cond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">);</span><span class="w"></span>
<span class="n">body</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span><span class="w"></span></pre><div class="m-graph"><svg style="width: 25.625rem; height: 6.812rem;" viewBox="0.00 0.00 410.18 108.77">
<g transform="scale(1 1) rotate(0) translate(4 104.7696)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fdba4000030</title>
<ellipse cx="28.9914" cy="-41.3848" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-37.5848">init</text>
</g>
<g class="m-node">
<title>p0x7fdba4000140</title>
<polygon points="185.9828,-67.3848 94.9828,-41.3848 185.9828,-15.3848 276.9828,-41.3848 185.9828,-67.3848"/>
<text text-anchor="middle" x="185.9828" y="-37.5848">while i&lt;5</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000030&#45;&gt;p0x7fdba4000140</title>
<path d="M58.1523,-41.3848C66.1156,-41.3848 75.2181,-41.3848 84.8151,-41.3848"/>
<polygon points="84.9683,-44.8849 94.9683,-41.3848 84.9683,-37.8849 84.9683,-44.8849"/>
</g>
<g class="m-node m-flat">
<title>p0x7fdba4000470</title>
<ellipse cx="362.5807" cy="-82.3848" rx="39.6962" ry="18.2703"/>
<text text-anchor="middle" x="362.5807" y="-78.5848">done</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000140&#45;&gt;p0x7fdba4000470</title>
<path stroke-dasharray="5,2" d="M236.5886,-53.1337C262.0295,-59.0402 292.6096,-66.1399 317.2714,-71.8655"/>
<polygon points="316.5666,-75.2949 327.099,-74.1471 318.1497,-68.4762 316.5666,-75.2949"/>
<text text-anchor="middle" x="299.9828" y="-72.5848">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fdba4000250</title>
<ellipse cx="362.5807" cy="-18.3848" rx="33.8824" ry="18.2703"/>
<text text-anchor="middle" x="362.5807" y="-14.5848">i++</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000140&#45;&gt;p0x7fdba4000250</title>
<path stroke-dasharray="5,2" d="M248.7418,-33.2111C272.0861,-30.1707 298.0361,-26.791 319.2576,-24.0271"/>
<polygon points="319.7993,-27.4863 329.2635,-22.724 318.8952,-20.5449 319.7993,-27.4863"/>
<text text-anchor="middle" x="299.9828" y="-32.5848">0</text>
</g>
<g class="m-edge">
<title>p0x7fdba4000250&#45;&gt;p0x7fdba4000140</title>
<path d="M328.4812,-20.3077C317.7423,-21.0739 305.8498,-22.0883 294.9828,-23.3848 280.9603,-25.0578 265.9872,-27.2574 251.7704,-29.5423"/>
<polygon points="250.8778,-26.1419 241.5765,-31.2149 252.0112,-33.0495 250.8778,-26.1419"/>
</g>
</g>
</svg>
</div><p>In the taskflow diagram above, the scheduler starts with <code>init</code> and then decrements the strong dependency of the loop condition task, <code>while i&lt;5</code>. After this, there remains one strong dependency, i.e., introduced by the loop body task, <code>i++</code>. However, task <code>i++</code> will not be executed until the loop condition task returns <code>0</code>, causing a deadlock.</p></section></section><section id="CreateAMultiConditionTask"><h2><a href="#CreateAMultiConditionTask">Create a Multi-condition Task</a></h2><p>A <em>multi-condition task</em> is a generalized version of conditional tasking. In some cases, applications need to jump to multiple branches from a parent task. This can be done by creating a <em>multi-condition task</em> which allows a task to select one or more successor tasks to execute. Similar to a condition task, a multi-condition task returns a vector of integer indices that indicate the successors to execute when the multi-condition task completes. The index is defined with respect to the order of successors preceded by a multi-condition task. For example, the following code creates a multi-condition task, <code>A</code>, that informs the scheduler to run on its two successors, <code>B</code> and <code>D</code>.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">SmallVector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;A</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span><span class="w"></span>
<span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;B</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">);</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;C</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;D</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">);</span><span class="w"></span>

<span class="n">A</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">);</span><span class="w"></span>

<span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><div class="m-graph"><svg style="width: 12.875rem; height: 9.438rem;" viewBox="0.00 0.00 206.00 150.77">
<g transform="scale(1 1) rotate(0) translate(4 146.7696)">
<title>Taskflow</title>
<g class="m-node">
<title>p0x7bc400014030</title>
<polygon points="99,-142.7696 72,-116.7696 99,-90.7696 126,-116.7696 99,-142.7696"/>
<text text-anchor="middle" x="99" y="-112.9696">A</text>
</g>
<g class="m-node m-flat">
<title>p0x7bc400014118</title>
<ellipse cx="27" cy="-18.3848" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="27" y="-14.5848">B</text>
</g>
<g class="m-edge">
<title>p0x7bc400014030&#45;&gt;p0x7bc400014118</title>
<path stroke-dasharray="5,2" d="M87.75,-101.3969C76.3977,-85.8845 58.6812,-61.6757 45.3039,-43.3963"/>
<polygon points="47.8626,-40.966 39.1324,-34.9632 42.2137,-45.1001 47.8626,-40.966"/>
<text text-anchor="middle" x="71" y="-59.9696">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7bc400014200</title>
<ellipse cx="99" cy="-18.3848" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="99" y="-14.5848">C</text>
</g>
<g class="m-edge">
<title>p0x7bc400014030&#45;&gt;p0x7bc400014200</title>
<path stroke-dasharray="5,2" d="M99,-90.6625C99,-77.2765 99,-60.9411 99,-47.1886"/>
<polygon points="102.5001,-46.8189 99,-36.8189 95.5001,-46.819 102.5001,-46.8189"/>
<text text-anchor="middle" x="104" y="-59.9696">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7bc4000142e8</title>
<ellipse cx="171" cy="-18.3848" rx="27" ry="18.2703"/>
<text text-anchor="middle" x="171" y="-14.5848">D</text>
</g>
<g class="m-edge">
<title>p0x7bc400014030&#45;&gt;p0x7bc4000142e8</title>
<path stroke-dasharray="5,2" d="M110.25,-101.3969C121.6023,-85.8845 139.3188,-61.6757 152.6961,-43.3963"/>
<polygon points="155.7863,-45.1001 158.8676,-34.9632 150.1374,-40.966 155.7863,-45.1001"/>
<text text-anchor="middle" x="148" y="-59.9696">2</text>
</g>
</g>
</svg>
</div><aside class="m-note m-info"><h4>Note</h4><p>The return type of a multi-condition task is <a href="classtf_1_1SmallVector.html" class="m-doc">tf::<wbr />SmallVector</a>, which provides C++ vector-style functionalities but comes with small buffer optimization.</p></aside><p>One important application of conditional tasking is implementing <em>iterative control flow</em>. You can use multi-condition tasks to create multiple loops that run concurrently. The following code creates a sequential chain of four loops in which each loop increments a counter variable ten times. When the program completes, the value of the counter variable is <code>40</code>.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">counter</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="kt">bool</span><span class="p">{</span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)]()</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">SmallVector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">counter</span><span class="p">.</span><span class="n">fetch_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="o">++</span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){});</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">loop</span><span class="p">);</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">loop</span><span class="p">);</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">loop</span><span class="p">);</span><span class="w"></span>

<span class="n">A</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">);</span><span class="w"></span>
<span class="n">B</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">);</span><span class="w"></span>
<span class="n">C</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">);</span><span class="w"></span>
<span class="n">D</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">D</span><span class="p">);</span><span class="w"></span>

<span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w">  </span><span class="c1">// counter == 40</span></pre><div class="m-graph"><svg style="width: 28.938rem; height: 6.000rem;" viewBox="0.00 0.00 462.98 96.00">
<g transform="scale(1 1) rotate(0) translate(4 92)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7bc400014030</title>
<ellipse cx="28.9914" cy="-26" rx="28.9828" ry="18.2703"/>
<text text-anchor="middle" x="28.9914" y="-22.2">init</text>
</g>
<g class="m-node">
<title>p0x7bc400014118</title>
<polygon points="121.9828,-52 94.9828,-26 121.9828,0 148.9828,-26 121.9828,-52"/>
<text text-anchor="middle" x="121.9828" y="-22.2">A</text>
</g>
<g class="m-edge">
<title>p0x7bc400014030&#45;&gt;p0x7bc400014118</title>
<path d="M58.1593,-26C66.5817,-26 75.8893,-26 84.7321,-26"/>
<polygon points="84.8183,-29.5001 94.8182,-26 84.8182,-22.5001 84.8183,-29.5001"/>
</g>
<g class="m-edge">
<title>p0x7bc400014118&#45;&gt;p0x7bc400014118</title>
<path stroke-dasharray="5,2" d="M114.4599,-44.9951C112.3423,-57.6662 114.8499,-70 121.9828,-70 127.1652,-70 129.906,-63.4891 130.2053,-55.0684"/>
<polygon points="133.6902,-54.7285 129.5056,-44.9951 126.707,-55.2136 133.6902,-54.7285"/>
<text text-anchor="middle" x="121.9828" y="-75.2">0</text>
</g>
<g class="m-node">
<title>p0x7bc400014200</title>
<polygon points="221.9828,-52 194.9828,-26 221.9828,0 248.9828,-26 221.9828,-52"/>
<text text-anchor="middle" x="221.9828" y="-22.2">B</text>
</g>
<g class="m-edge">
<title>p0x7bc400014118&#45;&gt;p0x7bc400014200</title>
<path stroke-dasharray="5,2" d="M149.0442,-26C160.0497,-26 172.9481,-26 184.8128,-26"/>
<polygon points="184.8997,-29.5001 194.8997,-26 184.8997,-22.5001 184.8997,-29.5001"/>
<text text-anchor="middle" x="171.9828" y="-31.2">1</text>
</g>
<g class="m-edge">
<title>p0x7bc400014200&#45;&gt;p0x7bc400014200</title>
<path stroke-dasharray="5,2" d="M213.6171,-44.0787C210.8934,-57.0646 213.682,-70 221.9828,-70 228.0786,-70 231.2017,-63.0239 231.3521,-54.1747"/>
<polygon points="234.8206,-53.6834 230.3484,-44.0787 227.8549,-54.3759 234.8206,-53.6834"/>
<text text-anchor="middle" x="221.9828" y="-75.2">0</text>
</g>
<g class="m-node">
<title>p0x7bc4000142e8</title>
<polygon points="322.9828,-52 294.9828,-26 322.9828,0 350.9828,-26 322.9828,-52"/>
<text text-anchor="middle" x="322.9828" y="-22.2">C</text>
</g>
<g class="m-edge">
<title>p0x7bc400014200&#45;&gt;p0x7bc4000142e8</title>
<path stroke-dasharray="5,2" d="M249.0489,-26C259.9858,-26 272.8069,-26 284.673,-26"/>
<polygon points="284.7836,-29.5001 294.7836,-26 284.7836,-22.5001 284.7836,-29.5001"/>
<text text-anchor="middle" x="271.9828" y="-31.2">1</text>
</g>
<g class="m-edge">
<title>p0x7bc4000142e8&#45;&gt;p0x7bc4000142e8</title>
<path stroke-dasharray="5,2" d="M314.5233,-44.537C311.9598,-57.3672 314.7796,-70 322.9828,-70 328.9428,-70 332.0611,-63.3312 332.3376,-54.7633"/>
<polygon points="335.8012,-54.1936 331.4422,-44.537 328.8279,-54.8042 335.8012,-54.1936"/>
<text text-anchor="middle" x="322.9828" y="-75.2">0</text>
</g>
<g class="m-node">
<title>p0x7bc4000143d0</title>
<polygon points="425.9828,-52 396.9828,-26 425.9828,0 454.9828,-26 425.9828,-52"/>
<text text-anchor="middle" x="425.9828" y="-22.2">D</text>
</g>
<g class="m-edge">
<title>p0x7bc4000142e8&#45;&gt;p0x7bc4000143d0</title>
<path stroke-dasharray="5,2" d="M351.128,-26C362.0923,-26 374.8484,-26 386.6906,-26"/>
<polygon points="386.7942,-29.5001 396.7942,-26 386.7941,-22.5001 386.7942,-29.5001"/>
<text text-anchor="middle" x="373.9828" y="-31.2">1</text>
</g>
<g class="m-edge">
<title>p0x7bc4000143d0&#45;&gt;p0x7bc4000143d0</title>
<path stroke-dasharray="5,2" d="M417.1849,-44.537C414.5189,-57.3672 417.4515,-70 425.9828,-70 432.1812,-70 435.4242,-63.3312 435.7118,-54.7633"/>
<polygon points="439.1731,-54.1784 434.7806,-44.537 432.2019,-54.8132 439.1731,-54.1784"/>
<text text-anchor="middle" x="425.9828" y="-75.2">0</text>
</g>
</g>
</svg>
</div><aside class="m-note m-warning"><h4>Attention</h4><p>It is your responsibility to ensure the return of a multi-condition task goes to a correct successor task. If a returned index falls outside the successor range of a multi-condition task, the scheduler will skip that index without doing anything.</p></aside></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v2.js"></script>
<script src="searchdata-v2.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Taskflow handbook is part of the <a href="https://taskflow.github.io">Taskflow project</a>, copyright © <a href="https://tsung-wei-huang.github.io/">Dr. Tsung-Wei Huang</a>, 2018&ndash;2022.<br />Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.14 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
